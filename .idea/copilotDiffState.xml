<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/QUICK_REFERENCE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/QUICK_REFERENCE.md" />
              <option name="updatedContent" value="#  SOS Feature Quick Reference&#10;&#10;## ✅ IMPLEMENTATION COMPLETE&#10;&#10;All features are now working:&#10;&#10;### Emergency Contacts (ProfileActivity)&#10;- ✅ Add contacts → Saves to Firestore&#10;- ✅ Edit contacts → Updates in Firestore  &#10;- ✅ Delete contacts → Removes from Firestore&#10;- ✅ View contacts → Displays in RecyclerView&#10;&#10;### SOS Alert (HomeActivity)&#10;- ✅ SOS button → Sends SMS to all contacts&#10;- ✅ Permission handling → Requests SMS permission&#10;- ✅ Confirmation dialog → Prevents accidents&#10;- ✅ Success/error feedback → Shows results&#10;&#10;##  Quick Test Steps&#10;&#10;1. **Run the app** (Build → Run)&#10;2. **Login** with your account&#10;3. **Go to Profile** (profile icon)&#10;4. **Add 1-2 emergency contacts** (use your phone numbers)&#10;5. **Return to Home**&#10;6. **Click &quot;EMERGENCY SOS&quot;**&#10;7. **Confirm** the alert&#10;8. **Grant SMS permission** when asked&#10;9. **Check your phones** for the emergency SMS!&#10;&#10;##  Emergency SMS Example&#10;&#10;You and your contacts will receive:&#10;```&#10; EMERGENCY ALERT &#10;&#10;John Doe needs help! This is an automated &#10;emergency message from CrimeTracking app.&#10;&#10;Please check on them immediately!&#10;```&#10;&#10;##  Key Files&#10;&#10;- `SmsHelper.kt` - SMS logic&#10;- `HomeActivity.kt` - SOS button handler&#10;- `ProfileActivity.kt` - Contact management (already working)&#10;- `AndroidManifest.xml` - SMS permissions&#10;- `EmergencyContact.kt` - Data model&#10;&#10;## ⚠️ Important&#10;&#10;- **Test with real numbers** - Use phone numbers you control&#10;- **SMS costs may apply** - Check your carrier plan&#10;- **Grant permission** - App needs SMS permission to work&#10;- **No errors found** - All code compiles correctly ✅&#10;&#10;##  What Users Can Do&#10;&#10;1. **Manage contacts** in Profile screen&#10;2. **Send SOS alerts** from Home screen&#10;3. **Receive immediate help** via SMS&#10;4. **Edit/delete** contacts anytime&#10;&#10;---&#10;&#10;**Status**: Ready to test!&#10;**All errors**: Fixed ✅&#10;**Ready for production**: After testing&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SMS_TROUBLESHOOTING.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SMS_TROUBLESHOOTING.md" />
              <option name="updatedContent" value="# SMS Not Working - Troubleshooting Guide&#10;&#10;## Common Issues &amp; Solutions&#10;&#10;### 1. Permission Not Granted&#10;**Check:**&#10;- Did you grant SMS permission when prompted?&#10;- Go to: Settings → Apps → CrimeTracking → Permissions → SMS → Allow&#10;&#10;**Solution:**&#10;```&#10;1. Open app settings on your phone&#10;2. Find CrimeTracking app&#10;3. Go to Permissions&#10;4. Enable SMS permission&#10;5. Try sending SOS again&#10;```&#10;&#10;### 2. No Emergency Contacts Added&#10;**Check:**&#10;- Did you add emergency contacts in Profile?&#10;- Are the phone numbers valid?&#10;&#10;**Solution:**&#10;```&#10;1. Open app → Profile&#10;2. Click &quot;+ Add&quot; under Emergency Contacts&#10;3. Add contact with:&#10;   - Name: Test Contact&#10;   - Relation: Friend&#10;   - Phone: YOUR_PHONE_NUMBER (with country code if needed)&#10;4. Save&#10;5. Go back to Home&#10;6. Try SOS button again&#10;```&#10;&#10;### 3. Invalid Phone Number Format&#10;**Check:**&#10;- Phone numbers should include country code for best results&#10;- Example formats that work:&#10;  - `+1234567890` (with country code)&#10;  - `1234567890` (10 digits for US)&#10;  - `(123) 456-7890` (formatted, will be cleaned)&#10;&#10;**Solution:**&#10;```&#10;1. Edit your emergency contact&#10;2. Update phone number to include country code&#10;3. US example: +12345678901&#10;4. Save and try again&#10;```&#10;&#10;### 4. Testing on Emulator&#10;**Issue:** Emulators cannot send real SMS messages&#10;&#10;**Solution:**&#10;```&#10;- MUST test on a PHYSICAL DEVICE&#10;- Emulators will fail silently&#10;- Connect real Android phone via USB&#10;- Run app on physical device&#10;```&#10;&#10;### 5. Firestore Connection Issues&#10;**Check Logcat for these errors:**&#10;```&#10;ProfileActivity: Error loading contacts&#10;SmsHelper: Error fetching emergency contacts&#10;```&#10;&#10;**Solution:**&#10;```&#10;1. Check internet connection&#10;2. Verify Firestore is enabled in Firebase Console&#10;3. Check Firestore security rules allow read/write&#10;4. Verify google-services.json is in app folder&#10;```&#10;&#10;### 6. SMS Manager Issues (Android Version)&#10;**For Android 10+:** Some permissions require additional setup&#10;&#10;**Solution - Add to AndroidManifest.xml:**&#10;```xml&#10;&lt;uses-permission android:name=&quot;android.permission.SEND_SMS&quot; /&gt;&#10;&lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot; /&gt;&#10;```&#10;&#10;### 7. Carrier/Network Issues&#10;**Check:**&#10;- Is your phone plan active?&#10;- Do you have SMS capability?&#10;- Are you in an area with network coverage?&#10;&#10;**Test:**&#10;```&#10;1. Open your phone's default messaging app&#10;2. Try sending a regular SMS to verify service works&#10;3. If that works, the issue is with the app&#10;4. If that fails, it's a carrier issue&#10;```&#10;&#10;## How to Check Logcat&#10;&#10;### Method 1: Android Studio&#10;```&#10;1. Connect phone via USB&#10;2. Enable USB Debugging on phone&#10;3. Open Android Studio → Logcat tab&#10;4. Filter by: &quot;SmsHelper&quot; or &quot;ProfileActivity&quot;&#10;5. Click SOS button&#10;6. Check for error messages&#10;```&#10;&#10;### Method 2: Command Line&#10;```&#10;adb logcat | findstr &quot;SmsHelper ProfileActivity HomeActivity&quot;&#10;```&#10;&#10;## Expected Logcat Output (Success)&#10;&#10;```&#10;ProfileActivity: Loaded 2 emergency contacts&#10;ProfileActivity: Contact: John Doe, Friend, +1234567890&#10;SmsHelper: SMS sent to John Doe at +1234567890&#10;HomeActivity: Alert sent to 1 contact(s)&#10;```&#10;&#10;## Expected Logcat Output (Failure)&#10;&#10;```&#10;SmsHelper: SMS permission not granted&#10;// OR&#10;ProfileActivity: Error loading contacts: [error message]&#10;// OR&#10;SmsHelper: Failed to send SMS to [name]: [error]&#10;```&#10;&#10;## Quick Diagnostic Checklist&#10;&#10;Run through this checklist:&#10;&#10;- [ ] Using a PHYSICAL DEVICE (not emulator)?&#10;- [ ] SMS permission is granted?&#10;- [ ] At least 1 emergency contact added?&#10;- [ ] Phone number is valid and complete?&#10;- [ ] Internet connection is active?&#10;- [ ] Logged into Firebase account?&#10;- [ ] Can send regular SMS from phone's messaging app?&#10;- [ ] USB debugging enabled to check Logcat?&#10;&#10;## Manual Test Steps&#10;&#10;### Step 1: Verify Contacts in Firestore&#10;```&#10;1. Open Firebase Console&#10;2. Go to Firestore Database&#10;3. Navigate to: users → [your-uid] → emergencyContacts&#10;4. Verify contacts exist with correct phone numbers&#10;```&#10;&#10;### Step 2: Test SMS Manually&#10;Try sending a test SMS from another app to verify your phone can send SMS.&#10;&#10;### Step 3: Check App Permissions&#10;```&#10;Settings → Apps → CrimeTracking → Permissions&#10;Ensure SMS is &quot;Allowed&quot;&#10;```&#10;&#10;### Step 4: Add Detailed Logging&#10;Check the updated SmsHelper.kt file with enhanced logging to see exactly where it fails.&#10;&#10;## Still Not Working?&#10;&#10;### Check these specific errors:&#10;&#10;**Error: &quot;No emergency contacts found&quot;**&#10;- Solution: Add contacts in Profile screen&#10;&#10;**Error: &quot;SMS permission not granted&quot;**&#10;- Solution: Grant permission in app settings&#10;&#10;**Error: &quot;Failed to send SMS&quot;**&#10;- Check: Is device in airplane mode?&#10;- Check: Is SIM card inserted?&#10;- Check: Is messaging app set as default?&#10;&#10;**No error shown at all**&#10;- Check: Is Firestore returning contacts?&#10;- Check: Look at Logcat for silent failures&#10;&#10;## Testing with Enhanced Logging&#10;&#10;The updated SmsHelper includes:&#10;1. Detailed logging at each step&#10;2. Contact count logging&#10;3. Phone number validation logging&#10;4. Success/failure for each contact&#10;5. Clear error messages&#10;&#10;Look for these logs:&#10;```&#10;SmsHelper: Fetching emergency contacts for user: [uid]&#10;SmsHelper: Found X contacts&#10;SmsHelper: Processing contact: [name] - [phone]&#10;SmsHelper: Sending SMS to cleaned number: [number]&#10;SmsHelper: SMS sent successfully to [name]&#10;```&#10;&#10;## Need More Help?&#10;&#10;1. Enable USB debugging&#10;2. Run the app&#10;3. Click SOS button&#10;4. Copy ALL Logcat output containing &quot;SmsHelper&quot;, &quot;ProfileActivity&quot;, &quot;HomeActivity&quot;&#10;5. Share the logs to identify the exact issue&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/START_HERE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/START_HERE.md" />
              <option name="updatedContent" value="#  SMS NOT WORKING? START HERE!&#10;&#10;## ⚡ QUICK FIX CHECKLIST&#10;&#10;Do these 5 things RIGHT NOW:&#10;&#10;### ✅ 1. Physical Device (Not Emulator!)&#10;```&#10;□ Using REAL Android phone (not emulator)&#10;```&#10;**Why:** Emulators CAN'T send SMS. Period.&#10;&#10;---&#10;&#10;### ✅ 2. Add Emergency Contact&#10;```&#10;□ App → Profile → &quot;+ Add&quot; button&#10;□ Name: Test&#10;□ Relation: Self  &#10;□ Phone: +1YOURNUMBER (your actual phone number!)&#10;□ Click &quot;Add&quot;&#10;□ SEE contact appear in list&#10;```&#10;**Why:** No contacts = no SMS sent&#10;&#10;---&#10;&#10;### ✅ 3. Grant SMS Permission&#10;```&#10;□ Click SOS button&#10;□ When asked, click &quot;Grant&quot;&#10;□ Click &quot;Allow&quot; on system dialog&#10;```&#10;**OR manually:**&#10;```&#10;□ Settings → Apps → CrimeTracking&#10;□ Permissions → SMS → Allow&#10;```&#10;**Why:** App needs permission to send SMS&#10;&#10;---&#10;&#10;### ✅ 4. Test SOS&#10;```&#10;□ Home screen → Red &quot;EMERGENCY SOS&quot; button&#10;□ Click &quot;Send Alert&quot; &#10;□ Wait 10 seconds&#10;□ Check YOUR phone for SMS&#10;```&#10;**Look for:** Success dialog saying &quot;Alert sent to 1 contact(s)&quot;&#10;&#10;---&#10;&#10;### ✅ 5. Check Phone Number Format&#10;```&#10;Good formats:&#10;  ✓ +12345678901&#10;  ✓ 2345678901&#10;  ✓ (234) 567-8901&#10;&#10;Bad formats:&#10;  ✗ 234-567 (too short)&#10;  ✗ test123 (invalid)&#10;```&#10;&#10;---&#10;&#10;##  EXPECTED RESULT&#10;&#10;### You Should Receive This SMS:&#10;```&#10; EMERGENCY ALERT &#10;&#10;[Your Name] needs help! This is an automated &#10;emergency message from CrimeTracking app.&#10;&#10;Please check on them immediately!&#10;```&#10;&#10;---&#10;&#10;##  STILL NOT WORKING?&#10;&#10;### Enable Enhanced Logging:&#10;I've updated the SmsHelper.kt with detailed logging.&#10;&#10;**To see logs:**&#10;1. Connect phone via USB&#10;2. Open Android Studio → Logcat tab&#10;3. Filter: `SmsHelper`&#10;4. Click SOS button in app&#10;5. Copy ALL logs that appear&#10;&#10;### What Logs Tell You:&#10;&#10;**If you see:**&#10;```&#10;SmsHelper: SMS permission check: false&#10;```&#10;→ **Fix:** Grant SMS permission&#10;&#10;**If you see:**&#10;```&#10;SmsHelper: Document count: 0&#10;```&#10;→ **Fix:** Add emergency contact&#10;&#10;**If you see:**&#10;```&#10;SmsHelper: ✓ SMS sent successfully to Test at +12345678901&#10;```&#10;→ **Good!** Check your phone's messaging app&#10;&#10;**If you see:**&#10;```&#10;SmsHelper: ✗ Failed to send SMS&#10;```&#10;→ **Fix:** Check phone number format, verify cellular service&#10;&#10;---&#10;&#10;##  MOST LIKELY ISSUES&#10;&#10;### 90% of the time it's ONE of these:&#10;&#10;1. **Testing on emulator** → Use physical device&#10;2. **No emergency contact added** → Add contact in Profile&#10;3. **SMS permission denied** → Grant permission&#10;4. **Wrong/invalid phone number** → Use +1XXXXXXXXXX format&#10;5. **Not checking the right phone** → Verify contact has YOUR number&#10;&#10;---&#10;&#10;##  TESTING TIPS&#10;&#10;### Best Way to Test:&#10;1. Add YOUR phone number as emergency contact&#10;2. Send SOS alert&#10;3. You should receive SMS on same phone&#10;4. SMS might come from app or show as &quot;sent to yourself&quot;&#10;&#10;### Alternative Test:&#10;1. Add a friend's phone number&#10;2. Ask them to watch for SMS&#10;3. Send SOS alert&#10;4. They should receive the emergency message&#10;&#10;---&#10;&#10;##  FILES UPDATED&#10;&#10;I've enhanced the code with:&#10;- ✅ Detailed logging at every step&#10;- ✅ Better error messages&#10;- ✅ Contact count validation&#10;- ✅ Phone number format validation&#10;- ✅ Success/failure tracking per contact&#10;&#10;**Run the app again** and the enhanced logging will show exactly what's happening!&#10;&#10;---&#10;&#10;##  TELL ME:&#10;&#10;If still not working, provide:&#10;1. ☐ Emulator or physical device?&#10;2. ☐ Did you add emergency contact? What phone number?&#10;3. ☐ Did you grant SMS permission?&#10;4. ☐ What dialog appears after clicking SOS?&#10;5. ☐ Copy Logcat output (filter: SmsHelper)&#10;&#10;With this info I can solve it immediately!&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/crimetracking/ProfileActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/crimetracking/ProfileActivity.kt" />
              <option name="updatedContent" value="package com.example.crimetracking&#10;&#10;import android.app.AlertDialog&#10;import android.os.Bundle&#10;import android.util.Patterns&#10;import android.view.LayoutInflater&#10;import android.view.View&#10;import android.widget.*&#10;import androidx.appcompat.app.AppCompatActivity&#10;import androidx.recyclerview.widget.LinearLayoutManager&#10;import androidx.recyclerview.widget.RecyclerView&#10;import com.google.firebase.auth.EmailAuthProvider&#10;import com.google.firebase.auth.FirebaseAuth&#10;import com.google.firebase.firestore.ktx.firestore&#10;import com.google.firebase.ktx.Firebase&#10;&#10;class ProfileActivity : AppCompatActivity() {&#10;&#10;    companion object {&#10;        private const val MAX_EMERGENCY_CONTACTS = 3&#10;    }&#10;&#10;    private lateinit var auth: FirebaseAuth&#10;    private val db = Firebase.firestore&#10;    private lateinit var emergencyContactsAdapter: EmergencyContactsAdapter&#10;    private val emergencyContacts = mutableListOf&lt;EmergencyContact&gt;()&#10;&#10;    private lateinit var tvFirstName: TextView&#10;    private lateinit var tvLastName: TextView&#10;    private lateinit var tvEmail: TextView&#10;    private lateinit var btnChangeEmail: Button&#10;    private lateinit var btnChangePassword: Button&#10;    private lateinit var btnAddEmergencyContact: Button&#10;    private lateinit var rvEmergencyContacts: RecyclerView&#10;    private lateinit var tvNoContacts: TextView&#10;    private lateinit var btnBack: ImageButton&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        setContentView(R.layout.activity_profile)&#10;&#10;        auth = FirebaseAuth.getInstance()&#10;&#10;        // Initialize views&#10;        tvFirstName = findViewById(R.id.tvFirstName)&#10;        tvLastName = findViewById(R.id.tvLastName)&#10;        tvEmail = findViewById(R.id.tvEmail)&#10;        btnChangeEmail = findViewById(R.id.btnChangeEmail)&#10;        btnChangePassword = findViewById(R.id.btnChangePassword)&#10;        btnAddEmergencyContact = findViewById(R.id.btnAddEmergencyContact)&#10;        rvEmergencyContacts = findViewById(R.id.rvEmergencyContacts)&#10;        tvNoContacts = findViewById(R.id.tvNoContacts)&#10;        btnBack = findViewById(R.id.btnBack)&#10;&#10;        // Setup RecyclerView&#10;        emergencyContactsAdapter = EmergencyContactsAdapter(&#10;            emergencyContacts,&#10;            onEditClick = { contact -&gt; showEditEmergencyContactDialog(contact) },&#10;            onDeleteClick = { contact -&gt; deleteEmergencyContact(contact) }&#10;        )&#10;        rvEmergencyContacts.layoutManager = LinearLayoutManager(this)&#10;        rvEmergencyContacts.adapter = emergencyContactsAdapter&#10;&#10;        // Load user data&#10;        loadUserProfile()&#10;        loadEmergencyContacts()&#10;&#10;        // Set click listeners&#10;        btnBack.setOnClickListener {&#10;            finish()&#10;        }&#10;&#10;        btnChangeEmail.setOnClickListener {&#10;            showChangeEmailDialog()&#10;        }&#10;&#10;        btnChangePassword.setOnClickListener {&#10;            showChangePasswordDialog()&#10;        }&#10;&#10;        btnAddEmergencyContact.setOnClickListener {&#10;            if (emergencyContacts.size &gt;= MAX_EMERGENCY_CONTACTS) {&#10;                AlertDialog.Builder(this)&#10;                    .setTitle(&quot;Maximum Contacts Reached&quot;)&#10;                    .setMessage(&quot;You can only have up to $MAX_EMERGENCY_CONTACTS emergency contacts. Please delete a contact before adding a new one.&quot;)&#10;                    .setPositiveButton(&quot;OK&quot;, null)&#10;                    .setIcon(android.R.drawable.ic_dialog_info)&#10;                    .show()&#10;            } else {&#10;                showAddEmergencyContactDialog()&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun loadUserProfile() {&#10;        val user = auth.currentUser&#10;        if (user != null) {&#10;            // Display email&#10;            tvEmail.text = user.email&#10;&#10;            // Load full name from Firestore&#10;            db.collection(&quot;users&quot;).document(user.uid)&#10;                .get()&#10;                .addOnSuccessListener { document -&gt;&#10;                    if (document != null &amp;&amp; document.exists()) {&#10;                        val fullName = document.getString(&quot;fullName&quot;) ?: &quot;&quot;&#10;                        val nameParts = fullName.split(&quot; &quot;, limit = 2)&#10;&#10;                        if (nameParts.isNotEmpty()) {&#10;                            tvFirstName.text = nameParts[0]&#10;                            if (nameParts.size &gt; 1) {&#10;                                tvLastName.text = nameParts[1]&#10;                            } else {&#10;                                tvLastName.text = &quot;&quot;&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;                .addOnFailureListener { e -&gt;&#10;                    Toast.makeText(this, &quot;Error loading profile: ${e.message}&quot;, Toast.LENGTH_SHORT).show()&#10;                }&#10;        }&#10;    }&#10;&#10;    private fun loadEmergencyContacts() {&#10;        val user = auth.currentUser&#10;        if (user != null) {&#10;            db.collection(&quot;users&quot;).document(user.uid)&#10;                .collection(&quot;emergencyContacts&quot;)&#10;                .get()&#10;                .addOnSuccessListener { documents -&gt;&#10;                    emergencyContacts.clear()&#10;                    android.util.Log.d(&quot;ProfileActivity&quot;, &quot;Loaded ${documents.size()} emergency contacts&quot;)&#10;                    for (document in documents) {&#10;                        val contact = EmergencyContact(&#10;                            id = document.id,&#10;                            name = document.getString(&quot;name&quot;) ?: &quot;&quot;,&#10;                            relation = document.getString(&quot;relation&quot;) ?: &quot;&quot;,&#10;                            phoneNumber = document.getString(&quot;phoneNumber&quot;) ?: &quot;&quot;&#10;                        )&#10;                        emergencyContacts.add(contact)&#10;                        android.util.Log.d(&quot;ProfileActivity&quot;, &quot;Contact: ${contact.name}, ${contact.relation}, ${contact.phoneNumber}&quot;)&#10;                    }&#10;                    emergencyContactsAdapter.notifyDataSetChanged()&#10;                    updateEmptyState()&#10;                }&#10;                .addOnFailureListener { e -&gt;&#10;                    android.util.Log.e(&quot;ProfileActivity&quot;, &quot;Error loading contacts&quot;, e)&#10;                    Toast.makeText(this, &quot;Error loading contacts: ${e.message}&quot;, Toast.LENGTH_SHORT).show()&#10;                }&#10;        }&#10;    }&#10;&#10;    private fun updateEmptyState() {&#10;        android.util.Log.d(&quot;ProfileActivity&quot;, &quot;updateEmptyState called. Contact count: ${emergencyContacts.size}&quot;)&#10;        if (emergencyContacts.isEmpty()) {&#10;            rvEmergencyContacts.visibility = View.GONE&#10;            tvNoContacts.visibility = View.VISIBLE&#10;            android.util.Log.d(&quot;ProfileActivity&quot;, &quot;Showing empty state&quot;)&#10;        } else {&#10;            rvEmergencyContacts.visibility = View.VISIBLE&#10;            tvNoContacts.visibility = View.GONE&#10;            android.util.Log.d(&quot;ProfileActivity&quot;, &quot;Showing RecyclerView with ${emergencyContacts.size} contacts&quot;)&#10;        }&#10;        &#10;        // Update button state based on contact limit&#10;        if (emergencyContacts.size &gt;= MAX_EMERGENCY_CONTACTS) {&#10;            btnAddEmergencyContact.isEnabled = false&#10;            btnAddEmergencyContact.alpha = 0.5f&#10;            android.util.Log.d(&quot;ProfileActivity&quot;, &quot;Maximum contacts reached ($MAX_EMERGENCY_CONTACTS), add button disabled&quot;)&#10;        } else {&#10;            btnAddEmergencyContact.isEnabled = true&#10;            btnAddEmergencyContact.alpha = 1.0f&#10;        }&#10;    }&#10;&#10;    private fun showChangeEmailDialog() {&#10;        val dialogView = LayoutInflater.from(this).inflate(R.layout.dialog_change_email, null)&#10;        val etNewEmail = dialogView.findViewById&lt;EditText&gt;(R.id.etNewEmail)&#10;        val etPassword = dialogView.findViewById&lt;EditText&gt;(R.id.etPassword)&#10;&#10;        AlertDialog.Builder(this)&#10;            .setTitle(&quot;Change Email&quot;)&#10;            .setView(dialogView)&#10;            .setPositiveButton(&quot;Change&quot;) { _, _ -&gt;&#10;                val newEmail = etNewEmail.text.toString().trim()&#10;                val password = etPassword.text.toString()&#10;&#10;                if (newEmail.isEmpty() || !Patterns.EMAIL_ADDRESS.matcher(newEmail).matches()) {&#10;                    Toast.makeText(this, &quot;Please enter a valid email&quot;, Toast.LENGTH_SHORT).show()&#10;                    return@setPositiveButton&#10;                }&#10;&#10;                if (password.isEmpty()) {&#10;                    Toast.makeText(this, &quot;Please enter your password&quot;, Toast.LENGTH_SHORT).show()&#10;                    return@setPositiveButton&#10;                }&#10;&#10;                changeEmail(newEmail, password)&#10;            }&#10;            .setNegativeButton(&quot;Cancel&quot;, null)&#10;            .show()&#10;    }&#10;&#10;    private fun changeEmail(newEmail: String, password: String) {&#10;        val user = auth.currentUser&#10;        if (user != null &amp;&amp; user.email != null) {&#10;            // Re-authenticate user first&#10;            val credential = EmailAuthProvider.getCredential(user.email!!, password)&#10;&#10;            user.reauthenticate(credential)&#10;                .addOnSuccessListener {&#10;                    // Update email in Firebase Auth&#10;                    @Suppress(&quot;DEPRECATION&quot;)&#10;                    user.updateEmail(newEmail)&#10;                        .addOnSuccessListener {&#10;                            // Update email in Firestore&#10;                            db.collection(&quot;users&quot;).document(user.uid)&#10;                                .update(&quot;email&quot;, newEmail)&#10;                                .addOnSuccessListener {&#10;                                    tvEmail.text = newEmail&#10;                                    Toast.makeText(this, &quot;Email updated successfully&quot;, Toast.LENGTH_SHORT).show()&#10;                                }&#10;                        }&#10;                        .addOnFailureListener { e -&gt;&#10;                            Toast.makeText(this, &quot;Error updating email: ${e.message}&quot;, Toast.LENGTH_SHORT).show()&#10;                        }&#10;                }&#10;                .addOnFailureListener { e -&gt;&#10;                    Toast.makeText(this, &quot;Authentication failed. Check your password.&quot;, Toast.LENGTH_SHORT).show()&#10;                }&#10;        }&#10;    }&#10;&#10;    private fun showChangePasswordDialog() {&#10;        val dialogView = LayoutInflater.from(this).inflate(R.layout.dialog_change_password, null)&#10;        val etCurrentPassword = dialogView.findViewById&lt;EditText&gt;(R.id.etCurrentPassword)&#10;        val etNewPassword = dialogView.findViewById&lt;EditText&gt;(R.id.etNewPassword)&#10;        val etConfirmPassword = dialogView.findViewById&lt;EditText&gt;(R.id.etConfirmPassword)&#10;&#10;        AlertDialog.Builder(this)&#10;            .setTitle(&quot;Change Password&quot;)&#10;            .setView(dialogView)&#10;            .setPositiveButton(&quot;Change&quot;) { _, _ -&gt;&#10;                val currentPassword = etCurrentPassword.text.toString()&#10;                val newPassword = etNewPassword.text.toString()&#10;                val confirmPassword = etConfirmPassword.text.toString()&#10;&#10;                if (currentPassword.isEmpty()) {&#10;                    Toast.makeText(this, &quot;Please enter current password&quot;, Toast.LENGTH_SHORT).show()&#10;                    return@setPositiveButton&#10;                }&#10;&#10;                if (newPassword.length &lt; 6) {&#10;                    Toast.makeText(this, &quot;New password must be at least 6 characters&quot;, Toast.LENGTH_SHORT).show()&#10;                    return@setPositiveButton&#10;                }&#10;&#10;                if (newPassword != confirmPassword) {&#10;                    Toast.makeText(this, &quot;Passwords do not match&quot;, Toast.LENGTH_SHORT).show()&#10;                    return@setPositiveButton&#10;                }&#10;&#10;                changePassword(currentPassword, newPassword)&#10;            }&#10;            .setNegativeButton(&quot;Cancel&quot;, null)&#10;            .show()&#10;    }&#10;&#10;    private fun changePassword(currentPassword: String, newPassword: String) {&#10;        val user = auth.currentUser&#10;        if (user != null &amp;&amp; user.email != null) {&#10;            // Re-authenticate user first&#10;            val credential = EmailAuthProvider.getCredential(user.email!!, currentPassword)&#10;&#10;            user.reauthenticate(credential)&#10;                .addOnSuccessListener {&#10;                    // Update password&#10;                    user.updatePassword(newPassword)&#10;                        .addOnSuccessListener {&#10;                            Toast.makeText(this, &quot;Password updated successfully&quot;, Toast.LENGTH_SHORT).show()&#10;                        }&#10;                        .addOnFailureListener { e -&gt;&#10;                            Toast.makeText(this, &quot;Error updating password: ${e.message}&quot;, Toast.LENGTH_SHORT).show()&#10;                        }&#10;                }&#10;                .addOnFailureListener { e -&gt;&#10;                    Toast.makeText(this, &quot;Authentication failed. Check your current password.&quot;, Toast.LENGTH_SHORT).show()&#10;                }&#10;        }&#10;    }&#10;&#10;    private fun showAddEmergencyContactDialog() {&#10;        val dialogView = LayoutInflater.from(this).inflate(R.layout.dialog_add_emergency_contact, null)&#10;        val etContactName = dialogView.findViewById&lt;EditText&gt;(R.id.etContactName)&#10;        val etContactRelation = dialogView.findViewById&lt;EditText&gt;(R.id.etContactRelation)&#10;        val etContactPhone = dialogView.findViewById&lt;EditText&gt;(R.id.etContactPhone)&#10;&#10;        val dialog = AlertDialog.Builder(this)&#10;            .setTitle(&quot;Add Emergency Contact&quot;)&#10;            .setView(dialogView)&#10;            .setPositiveButton(&quot;Add&quot;, null) // Set to null initially&#10;            .setNegativeButton(&quot;Cancel&quot;, null)&#10;            .create()&#10;&#10;        dialog.show()&#10;&#10;        // Override the positive button to prevent auto-dismiss&#10;        dialog.getButton(AlertDialog.BUTTON_POSITIVE).setOnClickListener {&#10;            val name = etContactName.text.toString().trim()&#10;            val relation = etContactRelation.text.toString().trim()&#10;            val phone = etContactPhone.text.toString().trim()&#10;&#10;            if (name.isEmpty()) {&#10;                etContactName.error = &quot;Name is required&quot;&#10;                return@setOnClickListener&#10;            }&#10;&#10;            if (relation.isEmpty()) {&#10;                etContactRelation.error = &quot;Relation is required&quot;&#10;                return@setOnClickListener&#10;            }&#10;&#10;            if (phone.isEmpty()) {&#10;                etContactPhone.error = &quot;Phone number is required&quot;&#10;                return@setOnClickListener&#10;            }&#10;&#10;            addEmergencyContact(name, relation, phone)&#10;            dialog.dismiss()&#10;        }&#10;    }&#10;&#10;    private fun addEmergencyContact(name: String, relation: String, phoneNumber: String) {&#10;        val user = auth.currentUser&#10;        if (user != null) {&#10;            val contactData = hashMapOf(&#10;                &quot;name&quot; to name,&#10;                &quot;relation&quot; to relation,&#10;                &quot;phoneNumber&quot; to phoneNumber,&#10;                &quot;createdAt&quot; to System.currentTimeMillis()&#10;            )&#10;&#10;            android.util.Log.d(&quot;ProfileActivity&quot;, &quot;Adding contact: $name, $relation, $phoneNumber&quot;)&#10;&#10;            db.collection(&quot;users&quot;).document(user.uid)&#10;                .collection(&quot;emergencyContacts&quot;)&#10;                .add(contactData)&#10;                .addOnSuccessListener { documentReference -&gt;&#10;                    android.util.Log.d(&quot;ProfileActivity&quot;, &quot;Contact added successfully with ID: ${documentReference.id}&quot;)&#10;                    val newContact = EmergencyContact(&#10;                        id = documentReference.id,&#10;                        name = name,&#10;                        relation = relation,&#10;                        phoneNumber = phoneNumber&#10;                    )&#10;                    emergencyContacts.add(newContact)&#10;                    emergencyContactsAdapter.notifyItemInserted(emergencyContacts.size - 1)&#10;                    updateEmptyState()&#10;                    android.util.Log.d(&quot;ProfileActivity&quot;, &quot;Total contacts now: ${emergencyContacts.size}&quot;)&#10;                    Toast.makeText(this, &quot;Emergency contact added&quot;, Toast.LENGTH_SHORT).show()&#10;                }&#10;                .addOnFailureListener { e -&gt;&#10;                    android.util.Log.e(&quot;ProfileActivity&quot;, &quot;Error adding contact&quot;, e)&#10;                    Toast.makeText(this, &quot;Error adding contact: ${e.message}&quot;, Toast.LENGTH_SHORT).show()&#10;                }&#10;        } else {&#10;            android.util.Log.e(&quot;ProfileActivity&quot;, &quot;User is null, cannot add contact&quot;)&#10;        }&#10;    }&#10;&#10;    private fun showEditEmergencyContactDialog(contact: EmergencyContact) {&#10;        val dialogView = LayoutInflater.from(this).inflate(R.layout.dialog_edit_emergency_contact, null)&#10;        val etContactName = dialogView.findViewById&lt;EditText&gt;(R.id.etContactName)&#10;        val etContactRelation = dialogView.findViewById&lt;EditText&gt;(R.id.etContactRelation)&#10;        val etContactPhone = dialogView.findViewById&lt;EditText&gt;(R.id.etContactPhone)&#10;&#10;        // Pre-fill with existing data&#10;        etContactName.setText(contact.name)&#10;        etContactRelation.setText(contact.relation)&#10;        etContactPhone.setText(contact.phoneNumber)&#10;&#10;        val dialog = AlertDialog.Builder(this)&#10;            .setTitle(&quot;Edit Emergency Contact&quot;)&#10;            .setView(dialogView)&#10;            .setPositiveButton(&quot;Save&quot;, null)&#10;            .setNegativeButton(&quot;Cancel&quot;, null)&#10;            .create()&#10;&#10;        dialog.show()&#10;&#10;        // Override the positive button to prevent auto-dismiss&#10;        dialog.getButton(AlertDialog.BUTTON_POSITIVE).setOnClickListener {&#10;            val name = etContactName.text.toString().trim()&#10;            val relation = etContactRelation.text.toString().trim()&#10;            val phone = etContactPhone.text.toString().trim()&#10;&#10;            if (name.isEmpty()) {&#10;                etContactName.error = &quot;Name is required&quot;&#10;                return@setOnClickListener&#10;            }&#10;&#10;            if (relation.isEmpty()) {&#10;                etContactRelation.error = &quot;Relation is required&quot;&#10;                return@setOnClickListener&#10;            }&#10;&#10;            if (phone.isEmpty()) {&#10;                etContactPhone.error = &quot;Phone number is required&quot;&#10;                return@setOnClickListener&#10;            }&#10;&#10;            updateEmergencyContact(contact, name, relation, phone)&#10;            dialog.dismiss()&#10;        }&#10;    }&#10;&#10;    private fun updateEmergencyContact(contact: EmergencyContact, name: String, relation: String, phoneNumber: String) {&#10;        val user = auth.currentUser&#10;        if (user != null) {&#10;            val contactData = hashMapOf(&#10;                &quot;name&quot; to name,&#10;                &quot;relation&quot; to relation,&#10;                &quot;phoneNumber&quot; to phoneNumber,&#10;                &quot;updatedAt&quot; to System.currentTimeMillis()&#10;            )&#10;&#10;            android.util.Log.d(&quot;ProfileActivity&quot;, &quot;Updating contact: ${contact.id}&quot;)&#10;&#10;            db.collection(&quot;users&quot;).document(user.uid)&#10;                .collection(&quot;emergencyContacts&quot;)&#10;                .document(contact.id)&#10;                .update(contactData as Map&lt;String, Any&gt;)&#10;                .addOnSuccessListener {&#10;                    android.util.Log.d(&quot;ProfileActivity&quot;, &quot;Contact updated successfully&quot;)&#10;                    // Update the contact in the list&#10;                    val position = emergencyContacts.indexOf(contact)&#10;                    if (position != -1) {&#10;                        emergencyContacts[position] = EmergencyContact(&#10;                            id = contact.id,&#10;                            name = name,&#10;                            relation = relation,&#10;                            phoneNumber = phoneNumber&#10;                        )&#10;                        emergencyContactsAdapter.notifyItemChanged(position)&#10;                        Toast.makeText(this, &quot;Contact updated&quot;, Toast.LENGTH_SHORT).show()&#10;                    }&#10;                }&#10;                .addOnFailureListener { e -&gt;&#10;                    android.util.Log.e(&quot;ProfileActivity&quot;, &quot;Error updating contact&quot;, e)&#10;                    Toast.makeText(this, &quot;Error updating contact: ${e.message}&quot;, Toast.LENGTH_SHORT).show()&#10;                }&#10;        } else {&#10;            android.util.Log.e(&quot;ProfileActivity&quot;, &quot;User is null, cannot update contact&quot;)&#10;        }&#10;    }&#10;&#10;    private fun deleteEmergencyContact(contact: EmergencyContact) {&#10;        AlertDialog.Builder(this)&#10;            .setTitle(&quot;Delete Contact&quot;)&#10;            .setMessage(&quot;Are you sure you want to delete ${contact.name}?&quot;)&#10;            .setPositiveButton(&quot;Delete&quot;) { _, _ -&gt;&#10;                val user = auth.currentUser&#10;                if (user != null) {&#10;                    db.collection(&quot;users&quot;).document(user.uid)&#10;                        .collection(&quot;emergencyContacts&quot;)&#10;                        .document(contact.id)&#10;                        .delete()&#10;                        .addOnSuccessListener {&#10;                            val position = emergencyContacts.indexOf(contact)&#10;                            if (position != -1) {&#10;                                emergencyContacts.removeAt(position)&#10;                                emergencyContactsAdapter.notifyItemRemoved(position)&#10;                                updateEmptyState()&#10;                                Toast.makeText(this, &quot;Contact deleted&quot;, Toast.LENGTH_SHORT).show()&#10;                            }&#10;                        }&#10;                        .addOnFailureListener { e -&gt;&#10;                            Toast.makeText(this, &quot;Error deleting contact: ${e.message}&quot;, Toast.LENGTH_SHORT).show()&#10;                        }&#10;                }&#10;            }&#10;            .setNegativeButton(&quot;Cancel&quot;, null)&#10;            .show()&#10;    }&#10;}&#10;&#10;// RecyclerView Adapter for Emergency Contacts&#10;class EmergencyContactsAdapter(&#10;    private val contacts: MutableList&lt;EmergencyContact&gt;,&#10;    private val onEditClick: (EmergencyContact) -&gt; Unit,&#10;    private val onDeleteClick: (EmergencyContact) -&gt; Unit&#10;) : RecyclerView.Adapter&lt;EmergencyContactsAdapter.ViewHolder&gt;() {&#10;&#10;    class ViewHolder(view: View) : RecyclerView.ViewHolder(view) {&#10;        val tvName: TextView = view.findViewById(R.id.tvContactName)&#10;        val tvRelation: TextView = view.findViewById(R.id.tvContactRelation)&#10;        val tvPhone: TextView = view.findViewById(R.id.tvContactPhone)&#10;        val btnEdit: ImageButton = view.findViewById(R.id.btnEditContact)&#10;        val btnDelete: ImageButton = view.findViewById(R.id.btnDeleteContact)&#10;    }&#10;&#10;    override fun onCreateViewHolder(parent: android.view.ViewGroup, viewType: Int): ViewHolder {&#10;        val view = LayoutInflater.from(parent.context)&#10;            .inflate(R.layout.item_emergency_contact, parent, false)&#10;        return ViewHolder(view)&#10;    }&#10;&#10;    override fun onBindViewHolder(holder: ViewHolder, position: Int) {&#10;        val contact = contacts[position]&#10;        holder.tvName.text = contact.name&#10;        holder.tvRelation.text = contact.relation&#10;        holder.tvPhone.text = contact.phoneNumber&#10;&#10;        holder.btnEdit.setOnClickListener {&#10;            onEditClick(contact)&#10;        }&#10;&#10;        holder.btnDelete.setOnClickListener {&#10;            onDeleteClick(contact)&#10;        }&#10;    }&#10;&#10;    override fun getItemCount() = contacts.size&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/build-app.bat">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/build-app.bat" />
              <option name="updatedContent" value="@echo off&#10;echo ========================================&#10;echo   Building Crime Tracking App&#10;echo ========================================&#10;echo.&#10;&#10;cd /d &quot;%~dp0&quot;&#10;&#10;echo Step 1: Cleaning project...&#10;call gradlew.bat clean&#10;&#10;echo.&#10;echo Step 2: Building project...&#10;call gradlew.bat build --stacktrace&#10;&#10;echo.&#10;echo ========================================&#10;echo   Build Complete!&#10;echo ========================================&#10;echo.&#10;echo If successful, you can now run the app.&#10;echo.&#10;pause&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>